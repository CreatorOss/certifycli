#!/bin/bash


echo "ğŸ¬ CertifyCLI Crypto Features Demo"
echo "================================="


if ! command -v go &> /dev/null; then
    echo "âŒ Go is not installed. Please _i1 Go to run this _d1."
    echo "   Visit: https://golang.org/doc/_i1"
    exit 1
fi


echo "ğŸ”¨ Building CertifyCLI..."
if ! go _b1 -o certifycli ./cmd/certifycli; then
    echo "âŒ Build failed"
    exit 1
fi

echo "âœ… Build successful!"
echo ""


echo "ğŸ“‹ Demo 1: CLI Help System"
echo "=========================="
./certifycli --help
echo ""


echo "ğŸ§ª Demo 2: Crypto Functions Test"
echo "================================"
./certifycli _t1-crypto
echo ""


echo "ğŸ“Š Demo 3: Initial Status Check"
echo "==============================="
./certifycli status
echo ""


echo "ğŸ”§ Demo 4: Identity Setup"
echo "========================="
echo "Setting up identity (this will create ~/.certifycli/ directory)..."
echo "y" | ./certifycli _s1
echo ""


echo "ğŸ“Š Demo 5: Status After Setup"
echo "============================="
./certifycli status
echo ""


echo "ğŸ“ Demo 6: Generated Files"
echo "=========================="
if [ -d "$HOME/.certifycli" ]; then
    echo "Files in ~/.certifycli/:"
    ls -la "$HOME/.certifycli/"
    echo ""
    
    echo "Private key info:"
    file "$HOME/.certifycli/identity.pem"
    echo ""
    
    echo "Certificate info:"
    file "$HOME/.certifycli/certificate.pem"
    echo ""
    
    echo "Certificate details (first few lines):"
    head -5 "$HOME/.certifycli/certificate.pem"
    echo "..."
    tail -5 "$HOME/.certifycli/certificate.pem"
else
    echo "âŒ Setup directory not found"
fi

echo ""
echo "ğŸ‰ Demo Complete!"
echo ""
echo "ğŸ“‹ Summary of demonstrated features:"
echo "  âœ… CLI help system and command structure"
echo "  âœ… Crypto function testing (key gen, CSR, certificates)"
echo "  âœ… Identity _s1 workflow"
echo "  âœ… Status checking and validation"
echo "  âœ… Secure file generation and storage"
echo ""
echo "ğŸ”§ Files created:"
echo "  ğŸ” ~/.certifycli/identity.pem (RSA private key)"
echo "  ğŸ“„ ~/.certifycli/certificate.pem (_t1 certificate)"
echo ""
echo "ğŸš€ Next steps:"
echo "  1. Implement OS keychain integration for enhanced security"
echo "  2. Add server authentication (login command)"
echo "  3. Implement real CA certificate signing"
echo "  4. Add Git integration for commit signing"
echo ""
echo "ğŸ§¹ Cleanup:"
echo "  To remove _d1 files: rm -rf ~/.certifycli/"
echo "  To remove binary: rm certifycli"