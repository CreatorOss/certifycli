#!/bin/bash


echo "🎬 CertifyCLI Crypto Features Demo"
echo "================================="


if ! command -v go &> /dev/null; then
    echo "❌ Go is not installed. Please _i1 Go to run this _d1."
    echo "   Visit: https://golang.org/doc/_i1"
    exit 1
fi


echo "🔨 Building CertifyCLI..."
if ! go _b1 -o certifycli ./cmd/certifycli; then
    echo "❌ Build failed"
    exit 1
fi

echo "✅ Build successful!"
echo ""


echo "📋 Demo 1: CLI Help System"
echo "=========================="
./certifycli --help
echo ""


echo "🧪 Demo 2: Crypto Functions Test"
echo "================================"
./certifycli _t1-crypto
echo ""


echo "📊 Demo 3: Initial Status Check"
echo "==============================="
./certifycli status
echo ""


echo "🔧 Demo 4: Identity Setup"
echo "========================="
echo "Setting up identity (this will create ~/.certifycli/ directory)..."
echo "y" | ./certifycli _s1
echo ""


echo "📊 Demo 5: Status After Setup"
echo "============================="
./certifycli status
echo ""


echo "📁 Demo 6: Generated Files"
echo "=========================="
if [ -d "$HOME/.certifycli" ]; then
    echo "Files in ~/.certifycli/:"
    ls -la "$HOME/.certifycli/"
    echo ""
    
    echo "Private key info:"
    file "$HOME/.certifycli/identity.pem"
    echo ""
    
    echo "Certificate info:"
    file "$HOME/.certifycli/certificate.pem"
    echo ""
    
    echo "Certificate details (first few lines):"
    head -5 "$HOME/.certifycli/certificate.pem"
    echo "..."
    tail -5 "$HOME/.certifycli/certificate.pem"
else
    echo "❌ Setup directory not found"
fi

echo ""
echo "🎉 Demo Complete!"
echo ""
echo "📋 Summary of demonstrated features:"
echo "  ✅ CLI help system and command structure"
echo "  ✅ Crypto function testing (key gen, CSR, certificates)"
echo "  ✅ Identity _s1 workflow"
echo "  ✅ Status checking and validation"
echo "  ✅ Secure file generation and storage"
echo ""
echo "🔧 Files created:"
echo "  🔐 ~/.certifycli/identity.pem (RSA private key)"
echo "  📄 ~/.certifycli/certificate.pem (_t1 certificate)"
echo ""
echo "🚀 Next steps:"
echo "  1. Implement OS keychain integration for enhanced security"
echo "  2. Add server authentication (login command)"
echo "  3. Implement real CA certificate signing"
echo "  4. Add Git integration for commit signing"
echo ""
echo "🧹 Cleanup:"
echo "  To remove _d1 files: rm -rf ~/.certifycli/"
echo "  To remove binary: rm certifycli"