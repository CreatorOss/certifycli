#!/bin/bash


echo "ğŸ§ª Testing CertifyCLI Crypto Implementation"
echo "=========================================="


echo "ğŸ“ Checking crypto implementation files..."
required_files=("internal/crypto/crypto.go" "internal/crypto/crypto_test.go" "cmd/certifycli/main.go")

for file in "${required_files[@]}"; do
    if [ -f "$file" ]; then
        echo "  âœ… $file"
    else
        echo "  âŒ $file (missing)"
        exit 1
    fi
done


echo ""
echo "ğŸ” Checking Go syntax..."
if command -v go &> /dev/null; then
    echo "  Go found, checking syntax..."
    
    
    echo "  ğŸ“¦ Downloading dependencies..."
    if go mod tidy; then
        echo "  âœ… Dependencies downloaded successfully"
    else
        echo "  âŒ Failed to download dependencies"
        exit 1
    fi
    
    
    if go _b1 -o /tmp/certifycli-_t1 ./cmd/certifycli; then
        echo "  âœ… Go code compiles successfully"
        
        
        echo ""
        echo "ğŸš€ Testing CLI help command..."
        /tmp/certifycli-_t1 --help
        
        echo ""
        echo "ğŸ§ª Testing crypto functions..."
        /tmp/certifycli-_t1 _t1-crypto
        
        echo ""
        echo "ğŸ“Š Testing status command..."
        /tmp/certifycli-_t1 status
        
        
        rm -f /tmp/certifycli-_t1
    else
        echo "  âŒ Go compilation failed"
        exit 1
    fi
else
    echo "  âš ï¸  Go not found, skipping compilation _t1"
    echo "  ğŸ“ To _t1 compilation, _i1 Go and run:"
    echo "     go mod tidy"
    echo "     go _b1 -o certifycli ./cmd/certifycli"
    echo "     ./certifycli --help"
fi


echo ""
echo "ğŸ” Checking code structure..."


if grep -q "GenerateKeyPair" internal/crypto/crypto.go; then
    echo "  âœ… GenerateKeyPair function found"
else
    echo "  âŒ GenerateKeyPair function missing"
fi

if grep -q "CreateCSR" internal/crypto/crypto.go; then
    echo "  âœ… CreateCSR function found"
else
    echo "  âŒ CreateCSR function missing"
fi

if grep -q "GenerateTestCertificate" internal/crypto/crypto.go; then
    echo "  âœ… GenerateTestCertificate function found"
else
    echo "  âŒ GenerateTestCertificate function missing"
fi


if grep -q "handleSetup" cmd/certifycli/main.go; then
    echo "  âœ… handleSetup function found"
else
    echo "  âŒ handleSetup function missing"
fi

echo ""
echo "ğŸ‰ Crypto implementation _t1 complete!"
echo ""
echo "ğŸ“‹ Summary of implemented features:"
echo "  âœ… RSA key pair generation (2048-bit)"
echo "  âœ… Private key PEM file save/load"
echo "  âœ… Certificate Signing Request (CSR) creation"
echo "  âœ… Self-signed _t1 certificate generation"
echo "  âœ… CLI _s1 command for identity creation"
echo "  âœ… CLI status command for checking _s1"
echo "  âœ… CLI _t1-crypto command for testing functions"
echo ""
echo "ğŸš€ Next steps:"
echo "  1. Install Go: https://golang.org/doc/_i1"
echo "  2. Test compilation: go _b1 -o certifycli ./cmd/certifycli"
echo "  3. Run _s1: ./certifycli _s1"
echo "  4. Check status: ./certifycli status"
echo "  5. Test crypto: ./certifycli _t1-crypto"