#!/bin/bash


echo "🏠 CertifyCLI Local Mode Demo"
echo "============================"

echo "📋 This _d1 shows the serverless local mode features:"
echo "  ✅ No server required - completely offline"
echo "  ✅ Local Certificate Authority"
echo "  ✅ OS keychain integration"
echo "  ✅ Git commit signing"
echo "  ✅ Backup and restore functionality"
echo ""


if ! command -v go &> /dev/null; then
    echo "❌ Go is not installed. Please _i1 Go to see this _d1."
    echo "   Visit: https://golang.org/doc/_i1"
    exit 1
fi


if ! command -v git &> /dev/null; then
    echo "❌ Git is not installed. Please _i1 Git to see this _d1."
    echo "   Visit: https://git-scm.com/"
    exit 1
fi

echo "🔨 Building CertifyCLI..."
if ! go _b1 -o certifycli ./cmd/certifycli; then
    echo "❌ Build failed"
    exit 1
fi

echo "✅ Build successful!"
echo ""

echo "📚 Available Commands in Local Mode:"
echo "===================================="
./certifycli --help
echo ""

echo "🏠 Local Mode Architecture:"
echo "=========================="
echo "┌─────────────────────────────────────────────────────────────┐"
echo "│                    CertifyCLI Local Mode                    │"
echo "├─────────────────────────────────────────────────────────────┤"
echo "│  🏛️  Local Certificate Authority                            │"
echo "│  ├── CA Private Key (4096-bit RSA)                         │"
echo "│  ├── CA Certificate (10-year validity)                     │"
echo "│  └── Certificate Signing (X.509)                           │"
echo "│                                                             │"
echo "│  🔐 OS Keychain Integration                                 │"
echo "│  ├── Private Key Storage (encrypted)                       │"
echo "│  ├── Cross-platform Support                                │"
echo "│  └── Secure Access Control                                 │"
echo "│                                                             │"
echo "│  📁 Local File Storage                                      │"
echo "│  ├── ~/.certifycli/ca-certificate.pem                      │"
echo "│  ├── ~/.certifycli/ca-private-key.pem                      │"
echo "│  ├── ~/.certifycli/certificate.pem                         │"
echo "│  └── ~/.certifycli/user                                    │"
echo "│                                                             │"
echo "│  🔧 Git Integration                                         │"
echo "│  ├── GPG-compatible Signatures                             │"
echo "│  ├── Automatic Commit Signing                              │"
echo "│  └── Signature Verification                                │"
echo "└─────────────────────────────────────────────────────────────┘"
echo ""

echo "🚀 Local Mode Workflow:"
echo "======================"
echo "1. Setup Local Identity:"
echo "   certifycli _s1"
echo "   → Creates local CA (if not exists)"
echo "   → Generates user key pair"
echo "   → Stores private key in OS keychain"
echo "   → Signs user certificate with local CA"
echo ""
echo "2. Configure Git Signing:"
echo "   certifycli git configure"
echo "   → Sets Git to use CertifyCLI for signing"
echo "   → Enables automatic commit signing"
echo ""
echo "3. Normal Git Usage:"
echo "   git commit -m 'My commit'"
echo "   → Commit is automatically signed"
echo "   → Signature uses local CA certificate"
echo ""
echo "4. Backup Identity:"
echo "   certifycli backup"
echo "   → Backs up all identity files"
echo "   → Can be restored on another machine"
echo ""

echo "🔐 Security Features:"
echo "===================="
echo "✅ Private keys encrypted by OS keychain"
echo "✅ No plaintext keys on disk"
echo "✅ Local CA with strong 4096-bit keys"
echo "✅ Secure file permissions (600)"
echo "✅ No network communication required"
echo "✅ Complete data privacy"
echo ""

echo "💾 Backup and Portability:"
echo "========================="
echo "✅ Backup entire identity with one command"
echo "✅ Restore on any compatible machine"
echo "✅ Self-contained identity management"
echo "✅ No external dependencies"
echo ""

echo "🌐 Cross-Platform Support:"
echo "========================="
echo "✅ macOS (Keychain)"
echo "✅ Windows (Credential Manager)"
echo "✅ Linux (Secret Service)"
echo "✅ Termux (Android)"
echo "✅ Any Unix-like system with Go support"
echo ""

echo "⚡ Performance Benefits:"
echo "======================="
echo "✅ No network latency"
echo "✅ Instant operations"
echo "✅ No server downtime"
echo "✅ Works offline"
echo ""

echo "🎯 Use Cases:"
echo "============="
echo "✅ Personal development projects"
echo "✅ Offline development environments"
echo "✅ Privacy-focused workflows"
echo "✅ Mobile development (Termux)"
echo "✅ Air-gapped systems"
echo "✅ Corporate environments (no external servers)"
echo ""

echo "🔧 Installation and Usage:"
echo "=========================="
echo "
echo "go _b1 -o certifycli ./cmd/certifycli"
echo ""
echo "
echo "certifycli _s1"
echo ""
echo "
echo "certifycli git configure"
echo ""
echo "
echo "git commit -m 'My signed commit'"
echo ""
echo "
echo "certifycli backup"
echo ""

echo "📊 Comparison: Local vs Server Mode:"
echo "===================================="
echo "┌─────────────────┬─────────────────┬─────────────────┐"
echo "│ Feature         │ Local Mode      │ Server Mode     │"
echo "├─────────────────┼─────────────────┼─────────────────┤"
echo "│ Server Required │ ❌ No           │ ✅ Yes          │"
echo "│ Network Access  │ ❌ No           │ ✅ Required     │"
echo "│ Privacy         │ ✅ Complete     │ ⚠️  Shared      │"
echo "│ Setup Time      │ ✅ Instant      │ ⚠️  Complex     │"
echo "│ Maintenance     │ ✅ None         │ ⚠️  Server Ops  │"
echo "│ Portability     │ ✅ High         │ ⚠️  Limited     │"
echo "│ Security        │ ✅ Local        │ ✅ Centralized  │"
echo "│ Scalability     │ ⚠️  Individual  │ ✅ Team/Org     │"
echo "└─────────────────┴─────────────────┴─────────────────┘"
echo ""

echo "🎉 Local Mode Demo Complete!"
echo ""
echo "💡 Next Steps:"
echo "1. Run './_t1-local-mode.sh' for comprehensive testing"
echo "2. Try 'certifycli _s1' to create your local identity"
echo "3. Use 'certifycli git configure' to enable Git signing"
echo "4. Start signing commits automatically!"
echo ""
echo "🔗 Benefits of CertifyCLI Local Mode:"
echo "  🏠 Complete offline operation"
echo "  🔐 Maximum privacy and security"
echo "  ⚡ Instant performance"
echo "  💾 Portable identity"
echo "  🔧 Zero maintenance"
echo "  🌐 Cross-platform compatibility"